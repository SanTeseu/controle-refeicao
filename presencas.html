<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Presenças</title>
  <link rel="stylesheet" href="style.css">
  <script type="module">
    import { supabase } from './app.js'

    async function carregarTrabalhadores() {
      const { data } = await supabase.from('trabalhadores').select('*')
      const tbody = document.querySelector('tbody')
      tbody.innerHTML = data.map(t => `
        <tr>
          <td>${t.nome}</td>
          <td><input type="checkbox" data-id="${t.id}" /></td>
        </tr>`).join('')
    }

    async function salvarPresencas() {
      const dataHoje = document.getElementById('data').value
      const refeicao = document.getElementById('refeicao').value
      const checks = document.querySelectorAll('input[type=checkbox]')
      const registros = Array.from(checks).map(ch => ({
        trabalhador_id: ch.dataset.id,
        data: dataHoje,
        refeicao,
        presente: ch.checked
      }))
      const { error } = await supabase.from('presencas').insert(registros)
      if (error) alert(error.message)
      else alert('Presenças salvas!')
    }

    window.onload = () => {
      carregarTrabalhadores()
      document.getElementById('salvar').onclick = salvarPresencas
    }
  </script>
</head>
<body>
  <header><h1>Presenças</h1></header>
  <main>
    <label>Data: <input id="data" type="date" value="" /></label>
    <label>Refeição: 
      <select id="refeicao">
        <option>Almoço</option>
        <option>Jantar</option>
      </select>
    </label>
    <button id="salvar">Salvar Presenças</button>

    <table>
      <thead><tr><th>Trabalhador</th><th>Presente?</th></tr></thead>
      <tbody></tbody>
    </table>
  </main>
</body>
</html>
